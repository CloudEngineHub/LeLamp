# Lamp Head

![](./assets/schematics.jpg)

LeLamp's head has 4 main functional component:

- Microphone
- Speaker
- LED
- Camera

All of these components are connected and controlled by a Pi Zero 2W.

## Assembly

Before mounting all components onto the lamp head, it is advised to assemble the electrical components first and test them. You can reference the above image for how this looks like.

### 1. OS

Using [Pi Imager](https://www.raspberrypi.com/software/), flash **Raspberry Pi OS Lite (64-bit)** onto your Raspberry Pi Zero 2W. You can reference how to do this [here](https://www.raspberrypi.com/documentation/computers/getting-started.html). In this tutorial, we used the Debian Bookworm version (released 2025-05-13).

When prompted to configure the settings on your pi, remember to:

- Set the Wifi SSID and password.
- Set the username and password.
- Set the hostname
- Enable SSH

### 2. Runtime

After successfully flashing your pi, SSH into it by running the following command:

```bash
ssh your_username@your_host_name.local
```

Then you need to set up [LeLamp Runtime](https://github.com/humancomputerlab/lelamp_runtime):

```bash
git clone https://github.com/humancomputerlab/lelamp_runtime.git
```

To use LeLamp's runtime, install uv:

```bash
curl -LsSf https://astral.sh/uv/install.sh | sudo sh
```

To setup the runtime:

```bash
cd lelamp_runtime
uv sync
```

This will take a while.

### 3. Setup Mic and Speaker

If you use the ReSpeaker Hat for Raspberry Pi, you can reference their tutorial [here](https://wiki.seeedstudio.com/respeaker_2_mics_pi_hat_raspberry_v2/). For convenience, the tutorial is below:

1. Get Device Tree Source (DTS) for the ReSpeaker 2-Mics Pi HAT (V2.0), compile it and install the device tree overlay.

   ```bash
   curl https://raw.githubusercontent.com/Seeed-Studio/seeed-linux-dtoverlays/refs/heads/master/overlays/rpi/respeaker-2mic-v2_0-overlay.dts -o respeaker-2mic-v2_0-overlay.dts
   dtc -I dts respeaker-2mic-v2_0-overlay.dts -o respeaker-2mic-v2_0-overlay.dtbo
   sudo dtoverlay respeaker-2mic-v2_0-overlay.dtbo
   sudo cp respeaker-2mic-v2_0-overlay.dtbo /boot/firmware/overlays
   ```

2. Edit /boot/firmware/config.txt:

   ```bash
   sudo tee -a /boot/firmware/config.txt >/dev/null <<'EOF'
   dtoverlay=respeaker-2mic-v2_0-overlay
   dtoverlay=i2s-mmap
   EOF
   ```

3. Reboot your device:

   ```bash
   sudo reboot
   ```

4. Check if your device is enabled:

```bash
aplay -l
```

The expected output should be like this:

```bash
card 2: seeed2micvoicec [seeed2micvoicec], device 0: 1f000a4000.i2s-tlv320aic3x-hifi tlv320aic3x-hifi-0 [1f000a4000.i2s-tlv320aic3x-hifi tlv320aic3x-hifi-0]
  Subdevices: 1/1
  Subdevice #0: subdevice #0
```

Afterwards, you can set up the sound level with the following command:

```bash
alsamixer
```

### 4. Test functionalities

#### Camera

For camera, run the following command:

```bash
libcamera-hello
```

You should expect an output like this:

```bash
[0:07:48.563548988] [1773]  INFO Camera camera_manager.cpp:326 libcamera v0.5.0+59-d83ff0a4
[0:07:48.749650563] [1777]  WARN RPiSdn sdn.cpp:40 Using legacy SDN tuning - please consider moving SDN inside rpi.denoise
[0:07:48.755845206] [1777]  INFO RPI vc4.cpp:447 Registered camera /base/soc/i2c0mux/i2c@1/ov5647@36 to Unicam device /dev/media2 and ISP device /dev/media0
[0:07:48.756141873] [1777]  INFO RPI pipeline_base.cpp:1121 Using configuration file '/usr/share/libcamera/pipeline/rpi/vc4/rpi_apps.yaml'
Preview window unavailable
Mode selection for 1296:972:12:P
    SGBRG10_CSI2P,640x480/0 - Score: 3296
    SGBRG10_CSI2P,1296x972/0 - Score: 1000
    SGBRG10_CSI2P,1920x1080/0 - Score: 1349.67
    SGBRG10_CSI2P,2592x1944/0 - Score: 1567
Stream configuration adjusted
[0:07:48.781597581] [1773]  INFO Camera camera.cpp:1205 configuring streams: (0) 1296x972-YUV420 (1) 1296x972-SGBRG10_CSI2P
[0:07:48.782340394] [1777]  INFO RPI vc4.cpp:622 Sensor: /base/soc/i2c0mux/i2c@1/ov5647@36 - Selected sensor format: 1296x972-SGBRG10_1X10 - Selected unicam format: 1296x972-pGAA
#0 (0.00 fps) exp 33239.00 ag 8.00 dg 1.00
#1 (30.00 fps) exp 33239.00 ag 8.00 dg 1.00
#2 (30.01 fps) exp 33239.00 ag 8.00 dg 1.00
```

#### RGB

For RGB, run the following command:

```bash
sudo uv run -m lelamp.test.test_rgb
```

#### Mic and Speaker

Install the necessary dependecies for audio:

```bash
sudo apt-get install portaudio19-dev
```

For Mic and Speaker, run the following command:

```bash
uv run -m lelamp.test.test_audio
```
